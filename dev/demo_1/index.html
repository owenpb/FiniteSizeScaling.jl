<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Demo 1: One-parameter scaling · FiniteSizeScaling.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link rel="canonical" href="https://owenpb.github.io/FiniteSizeScaling.jl/demo_1/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="FiniteSizeScaling.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">FiniteSizeScaling.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../methods/">Methods</a></li><li><a class="tocitem" href="../example_page/">Example: Holstein model</a></li><li class="is-active"><a class="tocitem" href>Demo 1: One-parameter scaling</a></li><li><a class="tocitem" href="../demo_2/">Demo 2: Two-parameter scaling</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Demo 1: One-parameter scaling</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Demo 1: One-parameter scaling</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/owenpb/FiniteSizeScaling.jl/blob/master/docs/src/demo_1.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Demo-1:-One-parameter-scaling"><a class="docs-heading-anchor" href="#Demo-1:-One-parameter-scaling">Demo 1: One-parameter scaling</a><a id="Demo-1:-One-parameter-scaling-1"></a><a class="docs-heading-anchor-permalink" href="#Demo-1:-One-parameter-scaling" title="Permalink"></a></h1><p>In this demo we will show how to perform finite-size scaling where one free parameter is tuned to obtain the best possible data collapse. We will use the CDW transition in the square lattice Holstein model as an example, where the critical inverse temperature <span>$\beta_c$</span> is to be optimized. </p><p>First, import the <a href="https://owenpb.github.io/FiniteSizeScaling.jl/dev/"><code>FiniteSizeScaling.jl</code></a> package:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using FiniteSizeScaling</code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><p>Before we can perform finite-size scaling, we need to have data for several difference lattice sizes <span>$L$</span>. Suppose we have five lattice sizes <span>$L=4, 6, 8, 10, 12$</span>. For each lattice size, we will have an array of <span>$X$</span> values (i.e. values of the inverse temperature <span>$\beta$</span>), an array of <span>$Y$</span> values (i.e. values of the order parameter <span>$S_{cdw}$</span>), and an array of <span>$E$</span> values which are the errors in each <span>$Y$</span> value. The data should be pre-arranged into arrays like this:</p><pre><code class="language- hljs">X_L4 = [1.973, 2.989, 3.978, 4.513, 4.754, 4.968, 5.182, 5.476, 5.743, 5.957, 6.225, 6.492, 7.000, 7.989, 8.979]
Y_L4 = [1.250, 1.806, 2.222, 3.056, 3.333, 3.750, 4.306, 4.583, 4.861, 5.278, 5.694, 5.972, 6.250, 6.806, 7.083]
E_L4 = [0.114, 0.123, 0.132, 0.128, 0.135, 0.121, 0.130, 0.101, 0.108, 0.139, 0.133, 0.138, 0.128, 0.199, 0.137]

X_L6 = [2.000, 2.989, 4.005, 4.513, 4.754, 4.995, 5.262, 5.476, 5.743, 6.011, 6.492, 7.000, 7.455, 7.989, 9.005, 9.995, 11.010, 12.000]
Y_L6 = [1.245, 1.667, 2.778, 4.444, 5.694, 6.667, 8.056, 9.306, 10.139, 10.972, 12.222, 13.333, 13.750, 14.167, 14.444, 14.583, 14.722, 14.722]
E_L6 = [0.164, 0.153, 0.152, 0.148, 0.165, 0.151, 0.150, 0.161, 0.138, 0.169, 0.153, 0.148, 0.138, 0.149, 0.167, 0.155, 0.147, 0.160]

X_L8 = [4.487, 4.727, 4.968, 5.235, 5.503, 5.743, 6.011, 6.225, 6.492, 6.733, 6.973, 7.267, 7.481, 7.775, 8.043, 8.524, 8.979, 10.021, 10.983, 12.000]
Y_L8 = [4.861, 5.694, 7.639, 10.278, 13.472, 15.417, 17.917, 19.583, 20.694, 21.528, 22.083, 22.361, 22.778, 23.194, 23.612, 23.889, 24.028, 24.583, 24.722, 24.722]
E_L8 = [0.252, 0.289, 0.243, 0.324, 0.489, 0.524, 0.578, 0.609, 0.575, 0.589, 0.625, 0.621, 0.650, 0.623, 0.621, 0.602, 0.658, 0.665, 0.667, 0.689]

X_L10 = [4.489, 4.757, 5.000, 5.244, 5.487, 5.755, 5.971, 6.293, 6.509, 6.750, 7.018, 7.259, 7.500, 7.768, 8.035, 10.041, 12.020]
Y_L10 = [4.583, 6.111, 9.306, 15.556, 19.861, 21.806, 25.833, 27.639, 31.111, 32.361, 33.333, 33.750, 34.722, 35.972, 35.694, 37.222, 37.500]
E_L10 = [0.254, 0.289, 0.501, 1.189, 1.184, 0.790, 0.804, 1.045, 0.600, 0.584, 0.598, 0.655, 0.680, 0.640, 0.601, 0.575, 0.478]

X_L12 = [4.493, 4.734, 4.981, 5.280, 5.528, 5.637, 5.777, 6.023, 6.268, 6.539, 6.809, 7.024, 7.292]
Y_L12 = [5.432, 6.964, 11.838, 16.713, 23.120, 25.627, 31.058, 36.072, 40.669, 43.454, 45.822, 47.075, 48.050]
E_L12 = [0.321, 0.398, 0.401, 0.556, 0.531, 0.598, 0.601, 0.592, 0.625, 0.630, 0.587, 0.658, 0.688]</code></pre><p>The next step is to create a single array of data, where each element is an array of <span>$[X, Y, E, L]$</span> data for a given lattice size. The length of this new array will equal the number of different lattice sizes being used:</p><pre><code class="language- hljs">data_with_error = [[X_L4, Y_L4, E_L4, 4], [X_L6, Y_L6, E_L6, 6], [X_L8, Y_L8, E_L8, 8], [X_L10, Y_L10, E_L10, 10], [X_L12, Y_L12, E_L12, 12]]</code></pre><p>If your <span>$Y$</span> data does not have error bars, you can also omit the arrays of error values, for example:</p><pre><code class="language- hljs">data_no_error = [[X_L4, Y_L4, 4], [X_L6, Y_L6, 6], [X_L8, Y_L8, 8], [X_L10, Y_L10, 10], [X_L12, Y_L12, 12]]</code></pre><p>At this point, you can call the function <a href="../methods/#FiniteSizeScaling.plot_data-Tuple{AbstractArray}"><code>plot_data</code></a> to display the raw unscaled data:</p><pre><code class="language- hljs">julia&gt; plot_data(data_with_error)</code></pre><p><img src="../raw_data.png" alt="Raw data"/></p><p>As discussed in the <a href="../example_page/">Example</a> page, we aim to rescale the data along new axes <span>$X_s = (\beta - \beta_c) L$</span> and <span>$Y_s = S_{cdw} L^{-7/4}$</span>. We will take <span>$\beta_c$</span> to be the one free parameter we will tune to obtain the optimal data collapse, and denote it <span>$v_1$</span>, i.e. our scaled axes will be <span>$X_s = (X - v_1) L$</span> and <span>$Y_s = Y L^{-7/4}$</span>. For one-parameter scaling, the user now must define two functions which define the scaled X and Y axes:</p><pre><code class="language- hljs">x_scaled(X, L, v1) = (X .- v1) * L</code></pre><pre><code class="language- hljs">y_scaled(Y, L, v1) = Y * (L^(-7/4))</code></pre><p>The function defining the <span>$X_s$</span> axis should take <span>$X$</span>, <span>$L$</span>, and <span>$v_1$</span> as arguments, while the function defining the scaled <span>$Y_s$</span> axis should take <span>$Y$</span>, <span>$L$</span>, and <span>$v_1$</span> as arguments. Note that since <span>$X$</span> and <span>$Y$</span> are arrays, elementwise operators such as <span>$.-$</span> may be necessary.</p><p>To determine the best value of <span>$v_1$</span>, a search is performed between an initial value <span>$v_{1i}$</span> and a final value <span>$v_{1f}$</span>. For each candidate value of <span>$v_1$</span>, the data is scaled according to the user-defined formulae above, and a polynomial curve of order <span>$p$</span> is fit to the data, using the method of least squares to minimize the sum of squared residuals between the scaled data and the polynomial curve. The value of <span>$v_1$</span> which yields the smallest sum of squared residuals is identified as the optimal value. </p><p>When performing the fit, one has the option to multiply each squared residual by a weight <span>$W$</span>. For example, to perform weighted-least squares, these weights are typically inverse variances. This means that data points with larger error bars will be deemed less important for the fit, and vice-versa. To use weights when performing the fit, define an array as follows:</p><pre><code class="language- hljs">fit_weights = [1 ./ (E_L4.^2), 1 ./ (E_L6.^2), 1 ./ (E_L8.^2), 1 ./ (E_L10.^2), 1 ./ (E_L12.^2)]</code></pre><p>where each element is an array of <span>$W$</span> values for a given lattice size. Here inverse variances have been chosen to perform a typical weighted least-squares. Note that the length of this array will equal the number of different lattice sizes being used. Using weights is completely optional and can be omitted if desired when calling the function <a href="../methods/#FiniteSizeScaling.fss_one_var-Tuple{}"><code>fss_one_var</code></a>.</p><p>The next step is to call the function <a href="../methods/#FiniteSizeScaling.fss_one_var-Tuple{}"><code>fss_one_var</code></a> to perform the finite-size scaling. </p><pre><code class="language- hljs">julia&gt; scaled_data, residuals, min_res, best_v1 = fss_one_var(data=data_with_error, xs=x_scaled, ys=y_scaled, v1i=5.0, v1f=7.0, n1=100, p=4, weights=fit_weights)</code></pre><p>where <code>data</code> is the single array of data defined previously, <code>xs</code> and <code>ys</code> are the functions previously defined for the scaled axes, <code>v1i</code> and <code>v1f</code> are the start and end points of the parameter search, and <code>n1</code> is the number of values of <span>$v_1$</span> in this range to check. The integer degree <span>$p$</span> of the polynomial must also be specified, typically <span>$4 \leq p \leq 8$</span> is sufficient.  </p><p>The function <a href="../methods/#FiniteSizeScaling.fss_one_var-Tuple{}"><code>fss_one_var</code></a> returns four variables: an array <code>scaled_data_array</code> where each element is an array of <span>$[X_s, Y_s, E_s, L]$</span> data for a given lattice size; an array <code>residuals</code> of length <code>n1</code> which stores the sum of squared residuals for each value of <span>$v_1$</span> checked; a scalar <code>min_res</code> which is the minimum value of the array <code>residuals</code>; and a scalar <code>best_v1</code> which is the value of <span>$v_1$</span> which gave the smallest overall residual. By default it will also print out the values of <code>best_v1</code> and <code>min_res</code>:</p><pre><code class="language- hljs">Optimal v1 value: 6.1313131313131315 
Smallest residual: 0.12847365603386035 </code></pre><div class="admonition is-info"><header class="admonition-header">Note: When $Y_s$ explicitly depends on $v_1$ set norm_y=true</header><div class="admonition-body"><p>When the scaled vertical axis <span>$Y_s$</span> has an explicit dependence on the tuned parameter <span>$v_1$</span> (and/or <span>$v_2$</span> for two-parameter scaling), the magnitude of <span>$Y_s$</span> values can vary drastically during the parameter sweep. In determining the <em>relative</em> quality of fit of a polynomial to the scaled data, the absolute magnitude of the sum of squared residuals therefore may not be an appropriate choice. </p><p>In this case, each individual fit residual should be divided by the magnitude <span>$Y_s$</span> of the corresponding data point. Then, the sum of the squares of these &quot;normalized&quot; residuals will provide a true measure of the relative quality of the polynomial fitting.</p><p>To do this, both <a href="../methods/#FiniteSizeScaling.fss_one_var-Tuple{}"><code>fss_one_var</code></a> and <a href="../methods/#FiniteSizeScaling.fss_two_var-Tuple{}"><code>fss_two_var</code></a> take an optional boolean argument <code>norm_y</code>. Set <code>norm_y=true</code> to normalize the fit residuals. </p></div></div><p>At this point, you can again call the function <a href="../methods/#FiniteSizeScaling.plot_data-Tuple{AbstractArray}"><code>plot_data</code></a>, passing in the <code>scaled_data_array</code> returned by the <a href="../methods/#FiniteSizeScaling.fss_one_var-Tuple{}"><code>fss_one_var</code></a> function. This will produce a plot of the optimal data collapse, i.e. the scaled data with <span>$v_1$</span> set to <code>best_v1</code>:</p><pre><code class="language- hljs">julia&gt; plot_data(scaled_data)</code></pre><p><img src="../scaled_data.png" alt="Scaled data"/></p><p>After one-parameter finite-size scaling has been performed, we can plot the dependence of the sum of squared residuals on <span>$v_1$</span>. To do this use the <a href="../methods/#FiniteSizeScaling.plot_residuals-Tuple{AbstractVector}"><code>plot_residuals</code></a> function, and pass in the array of residuals returned by <a href="../methods/#FiniteSizeScaling.fss_one_var-Tuple{}"><code>fss_one_var</code></a>, along with the exact values of <code>v1i</code>, <code>v1f</code>, and <code>n1</code> which were used:</p><pre><code class="language- hljs">julia&gt; plot_residuals(residuals, v1i=5.0, v1f=7.0, n1=100)</code></pre><p><img src="../residuals_plot.png" alt="Residuals plot"/></p><div class="admonition is-success"><header class="admonition-header">Tip</header><div class="admonition-body"><p>When using plotting functions such as <a href="../methods/#FiniteSizeScaling.plot_data-Tuple{AbstractArray}"><code>plot_data</code></a> or <a href="../methods/#FiniteSizeScaling.plot_residuals-Tuple{AbstractVector}"><code>plot_residuals</code></a>, various plot attributes such as axes labels, font sizes, marker sizes, colors, and figure dimensions can be passed as optional arguments. See the docstrings of each plotting function or the <a href="../methods/">Methods</a> page for full details. </p></div></div></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../example_page/">« Example: Holstein model</a><a class="docs-footer-nextpage" href="../demo_2/">Demo 2: Two-parameter scaling »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.15 on <span class="colophon-date" title="Friday 17 June 2022 12:33">Friday 17 June 2022</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
